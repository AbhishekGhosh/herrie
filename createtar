#!/bin/sh

set -e

if [ $# != 1 ]
then
	echo "usage: $0 version"
	exit 1
fi

FILENAME="herrie-$1.tar.bz2"
TARBZ2="www/distfiles/$FILENAME"
TARGZ="www/distfiles/herrie-$1.tar.gz"

cd `dirname $0`

if [ -e $TARBZ2 ]
then
	echo "$TARBZ2: file already exists"
	exit 1
fi

mkdir -p www/distfiles
git archive --format=tar --prefix="herrie-$1/" HEAD:herrie |
    bzip2 -9 > $TARBZ2
bzip2 -d < $TARBZ2 | gzip -9 > $TARGZ

cd www/distfiles
md5 $FILENAME
sha256 $FILENAME
stat -f "SIZE ($FILENAME) = %z" $FILENAME

echo "don't forget to run ./updatestuff!"
